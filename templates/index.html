<style>
    /* ...原有样式... */
    .badge-exec { font-size: 0.7rem; background-color: #ffc107; color: #000; padding: 2px 5px; border-radius: 4px; margin-left: 5px; }
</style>

<div class="d-flex justify-content-between align-items-center mb-1">
    <h6 class="fw-bold text-dark mb-0 small text-truncate" style="max-width: 80%;">
        {{ cmd.title }}
        {% if cmd.is_execute %}
        <span class="badge-exec" title="脚本中选择后将直接执行"><i class="fas fa-bolt"></i> Exec</span>
        {% endif %}
    </h6>
    <div>
        <button class="btn btn-sm btn-link text-primary p-0 me-2"
                data-bs-toggle="modal"
                data-bs-target="#editModal"
                data-id="{{ cmd.id }}"
                data-title="{{ cmd.title }}"
                data-content="{{ cmd.content }}"
                data-group="{{ group.id }}"
                data-sort="{{ cmd.sort_order }}"
                data-execute="{{ 'true' if cmd.is_execute else 'false' }}"
                style="font-size: 0.8rem;">
            <i class="fas fa-edit"></i>
        </button>
        </div>
</div>

<div class="modal fade" id="addModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header py-2">
                <h5 class="modal-title fs-6">新增命令</h5>
                <button type="button" class="btn-close small" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('add_command') }}" method="POST">
                <div class="modal-body p-3">
                    <div class="row mb-2">
                        <div class="col-8">
                            <label class="form-label small mb-1">分组</label>
                            <select name="group_id" class="form-select form-select-sm" required>
                                {% for g in all_groups %}
                                <option value="{{ g.id }}">{{ g.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-4">
                            <label class="form-label small mb-1">排序权重</label>
                            <input type="number" name="sort_order" class="form-control form-control-sm" value="0">
                        </div>
                    </div>

                    <div class="mb-2">
                        <label class="form-label small mb-1">标题</label>
                        <input type="text" name="title" class="form-control form-control-sm" required>
                    </div>

                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="add-execute" name="is_execute">
                        <label class="form-check-label small" for="add-execute">在脚本中直接执行 (不只是复制)</label>
                    </div>

                    <div class="mb-0">
                        <label class="form-label small mb-1">内容</label>
                        <textarea name="content" class="form-control form-control-sm cmd-font" rows="4" required></textarea>
                    </div>
                </div>
                <div class="modal-footer py-1">
                    <button type="submit" class="btn btn-success btn-sm">保存</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="editForm" method="POST">
                <div class="modal-body p-3">
                    <div class="row mb-2">
                        <div class="col-8">
                            <label class="form-label small mb-1">分组</label>
                            <select name="group_id" id="edit-group" class="form-select form-select-sm" required>
                                {% for g in all_groups %}
                                <option value="{{ g.id }}">{{ g.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-4">
                            <label class="form-label small mb-1">排序权重</label>
                            <input type="number" name="sort_order" id="edit-sort" class="form-control form-control-sm" value="0">
                        </div>
                    </div>

                    <div class="mb-2">
                        <label class="form-label small mb-1">标题</label>
                        <input type="text" name="title" id="edit-title" class="form-control form-control-sm" required>
                    </div>

                    <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="edit-execute" name="is_execute">
                        <label class="form-check-label small" for="edit-execute">在脚本中直接执行</label>
                    </div>

                    <div class="mb-0">
                        <label class="form-label small mb-1">内容</label>
                        <textarea name="content" id="edit-content" class="form-control form-control-sm cmd-font" rows="4" required></textarea>
                    </div>
                </div>
                <div class="modal-footer py-1">
                    <button type="submit" class="btn btn-primary btn-sm">更新</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // ... 原有 JS 代码 ...

    // 编辑模态框赋值逻辑更新
    const editModal = document.getElementById('editModal');
    editModal.addEventListener('show.bs.modal', event => {
        const button = event.relatedTarget;
        document.getElementById('edit-title').value = button.getAttribute('data-title');
        document.getElementById('edit-content').value = button.getAttribute('data-content');
        document.getElementById('edit-group').value = button.getAttribute('data-group');
        document.getElementById('edit-sort').value = button.getAttribute('data-sort');

        // 处理 Checkbox 状态
        const isExec = button.getAttribute('data-execute') === 'true';
        document.getElementById('edit-execute').checked = isExec;

        document.getElementById('editForm').action = '/command/edit/' + button.getAttribute('data-id');
    });
</script>